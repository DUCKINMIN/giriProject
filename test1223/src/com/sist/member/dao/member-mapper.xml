<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sist.member.dao.member-mapper">
	<sql id="where-email">
		WHERE m_email=#{m_email}
	</sql>
	<!-- 이메일 중복확인 -->
	<select id="emailCheck" resultType="int" parameterType="String">
		SELECT COUNT(*)
		FROM member
		<include refid="where-email"/>
	</select>
	<!-- 닉네임 중복확인-->
	<select id="nickCheck" resultType="int" parameterType="String">
		SELECT COUNT(*)
		FROM member
		WHERE m_nick=#{m_nick}
	</select>
	<!-- 회원가입 -->
	<insert id="memberJoin" parameterType="MemberVo">
		INSERT INTO member 
		VALUES(#{m_email},#{m_pwd},#{m_name},#{m_sex},#{m_birth},#{m_nick},SYSDATE,#{m_grade},#{m_tel},#{m_companyno},#{m_profile})
	</insert>
	<!-- 로그인 -->
	<select id="isLogin" resultType="MemberVo" parameterType="String">
		SELECT m_email,m_pwd,m_nick,m_sex,m_profile,m_grade
		FROM member 
		<include refid="where-email"/>
	</select>
	<!-- 전화번호 체크 -->
	<select id="telCount" resultType="int" parameterType="String">
		SELECT COUNT(*)
		FROM member
		WHERE m_tel=#{m_tel}
	</select>
	<!-- 이메일 찾기 -->
	<select id="emailFind" resultType="MemberVo" parameterType="String">
		SELECT m_name,m_email
		FROM member
		WHERE m_tel=#{m_tel}
	</select>
	<!-- 비밀번호 찾기 -->
	<select id="pwdFind" resultType="MemberVo" parameterType="String">
		SELECT m_pwd,m_email
		FROM member
		WHERE m_tel=#{m_tel}
	</select>

	<!-- 회원정보 출력 -->
	<select id="memberInfo" resultType="MemberVo" parameterType="String">
		SELECT m_email,m_name,m_sex,m_nick,m_tel,m_grade,m_birth,m_regdate,m_companyno,m_profile
		FROM member
		<include refid="where-email"/>
	</select>
	<!-- mynick 중복확인-->
	<select id="myNickCheck" resultType="int" parameterType="java.util.Map">
		SELECT COUNT(*)
		FROM (select m_nick from member WHERE NOT m_nick=#{mynick})
		WHERE m_nick=#{m_nick}
	</select>
	<!-- 회원정보 수정 -->
	<insert id="myinfo_update" parameterType="MemberVo">
		UPDATE member 
		SET m_nick=#{m_nick}, m_profile=#{m_profile}, m_companyno=#{m_companyno}
		WHERE m_email=#{m_email}
	</insert>
	<!-- 회원정보 수정2 -->
	<insert id="myinfo_update2" parameterType="MemberVo">
		UPDATE member 
		SET m_nick=#{m_nick}, m_profile=#{m_profile}
		WHERE m_email=#{m_email}
	</insert>
</mapper>

